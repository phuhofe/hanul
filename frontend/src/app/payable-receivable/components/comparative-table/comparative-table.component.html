<div>
  <form [formGroup]="form" class="p-0">
    <table
      mat-table
      matSort
      [dataSource]="dataSource"
      formArrayName="payableReceivable"
      class="w-100 bg-transparent"
      multiTemplateDataRows
      (matSortChange)="sortData($event)"
    >
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef class="pe-3 checkbox">
          <mat-checkbox
            color="primary"
            (change)="$event ? masterToggle() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>

        <td mat-cell *matCellDef="let row" class="pe-3 checkbox">
          <mat-checkbox
            color="primary"
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <ng-container matColumnDef="totalAmountPayable">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{ "payableReceivablePage.table.totalAmountPayable" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit">
            {{ element.totalAmountPayable }}
          </div>
          <div
            *ngIf="element.isEdit"
            [formGroupName]="element.id"
            (click)="$event.stopPropagation()"
          >
            <input class="cell-input" formControlName="totalAmountPayable" />
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef>$ 77,129,000</td>
      </ng-container>

      <ng-container matColumnDef="amountPayed">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.amountPayed" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.amountPayed }}
          </div>
          <div
            *ngIf="element.isEdit"
            [formGroupName]="element.id"
            (click)="$event.stopPropagation()"
          >
            <input class="cell-input" formControlName="amountPayed" />
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef>$ 77,129,000</td>
      </ng-container>

      <ng-container matColumnDef="amountBought">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.amountBought" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.amountBought }}
          </div>
          <div
            *ngIf="element.isEdit"
            [formGroupName]="element.id"
            (click)="$event.stopPropagation()"
          >
            <input class="cell-input" formControlName="amountBought" />
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef>$ 77,129,000</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.date" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.date | date: "YYYY-mm-dd" }}
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <ng-container matColumnDef="amountSold">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.amountSold" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.amountSold }}
          </div>
          <div
            *ngIf="element.isEdit"
            [formGroupName]="element.id"
            (click)="$event.stopPropagation()"
          >
            <input class="cell-input" formControlName="amountSold" />
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef>$ 320,129,000</td>
      </ng-container>

      <ng-container matColumnDef="amountReceived">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.amountReceived" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.amountReceived }}
          </div>
          <div
            *ngIf="element.isEdit"
            [formGroupName]="element.id"
            (click)="$event.stopPropagation()"
          >
            <input class="cell-input" formControlName="amountReceived" />
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef>$ 320,129,000</td>
      </ng-container>

      <ng-container matColumnDef="totalAmountReceivable">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.totalAmountReceivable" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.totalAmountReceivable }}
          </div>
          <div
            *ngIf="element.isEdit"
            [formGroupName]="element.id"
            (click)="$event.stopPropagation()"
          >
            <input class="cell-input" formControlName="totalAmountReceivable" />
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef>$ 320,129,000</td>
      </ng-container>

      <ng-container matColumnDef="branch">
        <th mat-header-cell *matHeaderCellDef class="custom-th" mat-sort-header>
          {{ "payableReceivablePage.table.branch" | transloco }}
        </th>
        <td mat-cell *matCellDef="let element; let rowIndex = index">
          <div *ngIf="!element.isEdit" class="amount-own-value">
            {{ element.branch }}
          </div>
        </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="17"
          class="p-0 ex pand-cell border-none"
        >
          <div
            class="data-detail w-100 bg-white"
            [ngClass]="{ 'd-none border-none': !checkExpanded(element) }"
          >
            <app-payable-expanded [type]="type"></app-payable-expanded>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        class="table-row"
        *matRowDef="let row; let element; columns: displayedColumns"
        (click)="pushPopElement(element)"
        [class.selected-row]="checkExpanded(element)"
      ></tr>
      <tr mat-footer-row *matFooterRowDef="displayedColumns; sticky: true"></tr>
      <tr
        mat-row
        *matRowDef="let element; columns: ['expandedDetail']"
        class="detail-row border-none"
        [@detailExpand]="checkExpanded(element) ? 'expanded' : 'collapsed'"
      ></tr>
    </table>
  </form>
  <mat-paginator
    [pageSizeOptions]="[10, 20, 50, 100]"
    showFirstLastButtons
    aria-label="Select page of periodic elements"
    class="bg-transparent"
    (page)="pageChange($event)"
  >
  </mat-paginator>
</div>
